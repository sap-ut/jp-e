<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JP Solutions ERP</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* All your existing CSS styles remain exactly the same */
/* ... CSS code ... */
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginBox">
  <div class="login">
    <h2>JP Solutions ERP</h2>
    <p style="font-size:13px;color:#555">Powered by JP</p>
    <input id="u" placeholder="Username" value="admin">
    <input id="p" type="password" placeholder="Password" value="admin123">
    <button onclick="login()">Login</button>
    <div class="error" id="err"></div>
    <p style="margin-top:15px;font-size:12px;color:#888">Use admin/admin123 for demo</p>
  </div>
</div>

<!-- APP -->
<div id="app">
  <!-- All your existing HTML structure remains the same -->
  <!-- ... HTML code ... -->
</div>

<script>
// Global Data Storage - FIXED: Changed variable declaration to be accessible globally
window.appData = {
  customers: [
    { id: 'CUST-001', name: 'ABC Construction', category: 'Retail' },
    { id: 'CUST-002', name: 'XYZ Developers', category: 'Wholesale' },
    { id: 'CUST-003', name: 'Modern Interiors', category: 'Contractor' }
  ],
  items: [
    { code: 'ITM-001', name: 'Glass Panel 6mm', category: 'Glass', unit: 'Sq. Ft' },
    { code: 'ITM-002', name: 'Aluminum Frame', category: 'Hardware', unit: 'Piece' },
    { code: 'ITM-003', name: 'Window Handle', category: 'Accessories', unit: 'Piece' }
  ],
  priceMaster: [
    { id: 1, customerId: 'CUST-001', itemCode: 'ITM-001', basePrice: 100, tax: 18, effectiveDate: '2024-01-01' },
    { id: 2, customerId: 'CUST-002', itemCode: 'ITM-001', basePrice: 95, tax: 18, effectiveDate: '2024-01-01' },
    { id: 3, customerId: 'CUST-003', itemCode: 'ITM-001', basePrice: 90, tax: 18, effectiveDate: '2024-01-01' }
  ]
};

// Login function - FIXED: Added proper validation and error handling
function login(){
  const u = document.getElementById('u').value;
  const p = document.getElementById('p').value;
  
  if(u === "admin" && p === "admin123"){
    document.getElementById('loginBox').style.display = "none";
    document.getElementById('app').style.display = "block";
    showWelcomeMessage();
    document.getElementById('err').innerText = "";
  } else if(u === "user" && p === "user123"){
    document.getElementById('loginBox').style.display = "none";
    document.getElementById('app').style.display = "block";
    showWelcomeMessage();
    document.getElementById('err').innerText = "";
  } else {
    document.getElementById('err').innerText = "Invalid username or password";
    document.getElementById('p').value = "";
    document.getElementById('p').focus();
  }
}

// Toggle dropdown
function toggleDropdown(event,el){
  event.stopPropagation();
  const d = el.querySelector('.dropdown');
  const rect = el.getBoundingClientRect();
  d.style.top = rect.bottom + "px";
  d.style.left = rect.left + "px";

  document.querySelectorAll('.dropdown').forEach(drop => {
    if(drop !== d) drop.classList.remove('show');
  });

  d.classList.toggle('show');
}

// Close dropdowns on body click
document.body.onclick = function(){
  document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('show'));
}

// Show welcome message
function showWelcomeMessage(){
  document.getElementById('moduleContent').innerHTML = `
    <div style="text-align:center;padding:50px;color:#666">
      <h2>Welcome to JP Solutions ERP</h2>
      <p>Select a module from the menu above to get started</p>
      <div style="margin-top:30px;font-size:14px;color:#888">
        <p>✅ All modules are fully functional</p>
        <p>✅ Click on any menu item to explore</p>
        <p>✅ Sample data is pre-loaded for demonstration</p>
      </div>
    </div>
  `;
}

// Module loading function - FIXED: Updated generatePriceMaster function
function loadModule(moduleName){
  document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('show'));
  
  let moduleContent = '';
  let moduleTitle = '';
  
  switch(moduleName){
    // Masters modules
    case 'itemMaster':
      moduleTitle = 'Item Master';
      moduleContent = generateItemMaster();
      break;
    case 'priceMaster':
      moduleTitle = 'Price Master';
      moduleContent = generatePriceMaster();
      break;
    case 'processMaster':
      moduleTitle = 'Process Master';
      moduleContent = generateProcessMaster();
      break;
    case 'cuttingRule':
      moduleTitle = 'Cutting Rule (Z Rule)';
      moduleContent = generateCuttingRule();
      break;
    case 'glassSize':
      moduleTitle = 'Glass Size Master (Jumbo Size)';
      moduleContent = generateGlassSize();
      break;
    case 'glassType':
      moduleTitle = 'Glass Type Master';
      moduleContent = generateGlassType();
      break;
    case 'routeMaster':
      moduleTitle = 'Route Master';
      moduleContent = generateRouteMaster();
      break;
    case 'paymentTerms':
      moduleTitle = 'Payment Terms Master';
      moduleContent = generatePaymentTerms();
      break;
    case 'filmType':
      moduleTitle = 'Film Type Master';
      moduleContent = generateFilmType();
      break;
    case 'bankMaster':
      moduleTitle = 'Bank Master';
      moduleContent = generateBankMaster();
      break;
    case 'vehicleMaster':
      moduleTitle = 'Vehicle Master';
      moduleContent = generateVehicleMaster();
      break;
    case 'additionalCharges':
      moduleTitle = 'Additional Charges Master';
      moduleContent = generateAdditionalCharges();
      break;
    case 'remarksMaster':
      moduleTitle = 'Remarks Master';
      moduleContent = generateRemarksMaster();
      break;
      
    // Transactions modules
    case 'proformaInvoice':
      moduleTitle = 'Proforma Invoice';
      moduleContent = generateProformaInvoice();
      break;
    case 'workOrder':
      moduleTitle = 'Work Order';
      moduleContent = generateWorkOrder();
      break;
    case 'salesInvoice':
      moduleTitle = 'Sales Invoice';
      moduleContent = generateSalesInvoice();
      break;
    case 'cuttingOptimizer':
      moduleTitle = 'Cutting Optimizer';
      moduleContent = generateCuttingOptimizer();
      break;
    case 'labelGeneration':
      moduleTitle = 'Label / Sticker Generation';
      moduleContent = generateLabelGeneration();
      break;
      
    // Inventory modules
    case 'hardwareInventory':
      moduleTitle = 'Hardware Inventory';
      moduleContent = generateHardwareInventory();
      break;
    case 'glassInventory':
      moduleTitle = 'Glass Inventory';
      moduleContent = generateGlassInventory();
      break;
      
    // System Settings modules
    case 'defaultConfig':
      moduleTitle = 'Default Configuration';
      moduleContent = generateDefaultConfig();
      break;
    case 'fileStorage':
      moduleTitle = 'File Storage Configuration';
      moduleContent = generateFileStorage();
      break;
    case 'networkConfig':
      moduleTitle = 'Network Configuration';
      moduleContent = generateNetworkConfig();
      break;
    case 'dataBackup':
      moduleTitle = 'Data Backup & Restore';
      moduleContent = generateDataBackup();
      break;
    case 'smsEmail':
      moduleTitle = 'SMS / Email Configuration';
      moduleContent = generateSmsEmail();
      break;
    case 'billingConfig':
      moduleTitle = 'Billing Configuration';
      moduleContent = generateBillingConfig();
      break;
    case 'printConfig':
      moduleTitle = 'Print Configuration';
      moduleContent = generatePrintConfig();
      break;
    case 'userAccess':
      moduleTitle = 'User Access Control';
      moduleContent = generateUserAccess();
      break;
    case 'softwareUpdate':
      moduleTitle = 'Software Update';
      moduleContent = generateSoftwareUpdate();
      break;
      
    // Customer Management modules
    case 'customerRegistration':
      moduleTitle = 'Customer Registration';
      moduleContent = generateCustomerRegistration();
      break;
    case 'customerList':
      moduleTitle = 'Customer List / Customer Master';
      moduleContent = generateCustomerList();
      break;
      
    // Sales Management modules
    case 'salespersonRegistration':
      moduleTitle = 'Salesperson Registration';
      moduleContent = generateSalespersonRegistration();
      break;
    case 'salespersonList':
      moduleTitle = 'Salesperson List';
      moduleContent = generateSalespersonList();
      break;
      
    // Reports modules
    case 'proformaReport':
      moduleTitle = 'Proforma Report';
      moduleContent = generateProformaReport();
      break;
    case 'invoiceReport':
      moduleTitle = 'Invoice Report';
      moduleContent = generateInvoiceReport();
      break;
    case 'salesPerformance':
      moduleTitle = 'Salesperson Performance Report';
      moduleContent = generateSalesPerformance();
      break;
    case 'productionReport':
      moduleTitle = 'Production Report';
      moduleContent = generateProductionReport();
      break;
    case 'workOrderReport':
      moduleTitle = 'Work Order Report';
      moduleContent = generateWorkOrderReport();
      break;
    case 'glassInventoryReport':
      moduleTitle = 'Glass Inventory Report';
      moduleContent = generateGlassInventoryReport();
      break;
    case 'breakageReport':
      moduleTitle = 'Breakage Report';
      moduleContent = generateBreakageReport();
      break;
    case 'rejectionReport':
      moduleTitle = 'Rejection Report';
      moduleContent = generateRejectionReport();
      break;
    case 'pendingBilling':
      moduleTitle = 'Pending Billing Report';
      moduleContent = generatePendingBilling();
      break;
    case 'billedArea':
      moduleTitle = 'Billed Area Report (Sq.Mtr)';
      moduleContent = generateBilledArea();
      break;
    case 'tallyExport':
      moduleTitle = 'Tally Export Report';
      moduleContent = generateTallyExport();
      break;
    case 'directInvoice':
      moduleTitle = 'Direct Invoice Report';
      moduleContent = generateDirectInvoice();
      break;
    case 'creditNote':
      moduleTitle = 'Credit Note Report';
      moduleContent = generateCreditNote();
      break;
      
    // User Management
    case 'userManagement':
      moduleTitle = 'User Management';
      moduleContent = generateUserManagement();
      break;
  }
  
  document.getElementById('moduleContent').innerHTML = `
    <div class="module-header">
      <h2>${moduleTitle}</h2>
      <div class="action-buttons">
        <button class="action-btn" onclick="saveModule('${moduleName}')">Save</button>
        <button class="action-btn action-btn-warning" onclick="printModule('${moduleName}')">Print</button>
        <button class="action-btn action-btn-success" onclick="exportModule('${moduleName}')">Export</button>
      </div>
    </div>
    ${moduleContent}
  `;
  
  window.scrollTo(0, 0);
}

// Logout function
function logout(){
  if(confirm('Are you sure you want to logout?')){
    document.getElementById('loginBox').style.display = "flex";
    document.getElementById('app').style.display = "none";
    document.getElementById('u').value = 'admin';
    document.getElementById('p').value = 'admin123';
    document.getElementById('err').innerText = '';
  }
}

// PRICE MASTER - FIXED: Updated to use global appData
function generatePriceMaster(){
  // Get all price records
  const priceRecords = appData.priceMaster.map(price => {
    const customer = appData.customers.find(c => c.id === price.customerId);
    const item = appData.items.find(i => i.code === price.itemCode);
    const finalPrice = price.basePrice + (price.basePrice * price.tax / 100);
    
    return {
      ...price,
      customerName: customer ? customer.name : 'Unknown',
      itemName: item ? item.name : 'Unknown',
      finalPrice: finalPrice
    };
  });
  
  return `
    <div class="tab-container">
      <div class="tab active" onclick="switchTab('priceTab', 'setup')">Setup Price</div>
      <div class="tab" onclick="switchTab('priceTab', 'view')">View Prices</div>
      <div class="tab" onclick="switchTab('priceTab', 'bulk')">Bulk Update</div>
    </div>
    
    <div id="setupPrice" class="tab-content active">
      <div class="form-container">
        <div>
          <div class="form-group">
            <label>Customer</label>
            <select id="priceCustomer" onchange="updateCustomerCategory()">
              <option value="">Select Customer</option>
              ${appData.customers.map(c => `<option value="${c.id}">${c.name} (${c.category})</option>`).join('')}
            </select>
          </div>
          <div class="form-group">
            <label>Customer Category</label>
            <input type="text" id="customerCategory" readonly>
          </div>
          <div class="form-group">
            <label>Item</label>
            <select id="priceItem" onchange="updateItemDetails()">
              <option value="">Select Item</option>
              ${appData.items.map(i => `<option value="${i.code}">${i.code} - ${i.name}</option>`).join('')}
            </select>
          </div>
        </div>
        <div>
          <div class="form-group">
            <label>Base Price</label>
            <input type="number" id="basePrice" value="100" oninput="calculateFinalPrice()">
          </div>
          <div class="form-group">
            <label>Tax (%)</label>
            <input type="number" id="taxPercent" value="18" oninput="calculateFinalPrice()">
          </div>
          <div class="form-group">
            <label>Final Price</label>
            <input type="number" id="finalPrice" value="118" readonly style="background:#f0f0f0">
          </div>
          <div class="form-group">
            <label>Effective Date</label>
            <input type="date" id="effectiveDate" value="${new Date().toISOString().split('T')[0]}">
          </div>
        </div>
      </div>
      <div style="margin-top:20px;text-align:center">
        <button class="action-btn action-btn-success" onclick="savePriceRecord()" style="padding:10px 30px">
          Save Price for this Customer
        </button>
        <button class="action-btn" onclick="savePriceForAllCustomers()" style="padding:10px 30px;margin-left:10px">
          Apply to All Customers
        </button>
      </div>
    </div>
    
    <div id="viewPrice" class="tab-content">
      <div class="report-controls">
        <input type="text" id="searchPrice" placeholder="Search customer or item..." 
               style="padding:8px;border-radius:6px;border:1px solid #ccc;flex-grow:1"
               onkeyup="filterPriceTable()">
        <select id="filterCustomer" style="padding:8px;border-radius:6px;border:1px solid #ccc" onchange="filterPriceTable()">
          <option value="">All Customers</option>
          ${appData.customers.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
        </select>
        <select id="filterItem" style="padding:8px;border-radius:6px;border:1px solid #ccc" onchange="filterPriceTable()">
          <option value="">All Items</option>
          ${appData.items.map(i => `<option value="${i.code}">${i.code}</option>`).join('')}
        </select>
      </div>
      
      <table class="data-table" id="priceTable">
        <thead>
          <tr>
            <th>Customer</th>
            <th>Customer Category</th>
            <th>Item Code</th>
            <th>Item Name</th>
            <th>Base Price</th>
            <th>Tax %</th>
            <th>Final Price</th>
            <th>Effective From</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          ${priceRecords.map(price => {
            const customer = appData.customers.find(c => c.id === price.customerId);
            return `
            <tr>
              <td>${price.customerName}</td>
              <td>${customer ? customer.category : ''}</td>
              <td>${price.itemCode}</td>
              <td>${price.itemName}</td>
              <td>₹${price.basePrice}</td>
              <td>${price.tax}%</td>
              <td><strong>₹${price.finalPrice.toFixed(2)}</strong></td>
              <td>${price.effectiveDate}</td>
              <td>
                <button onclick="editPrice(${price.id})" style="padding:4px 8px;background:#ffc107;border:none;border-radius:4px;cursor:pointer">Edit</button>
                <button onclick="deletePrice(${price.id})" style="padding:4px 8px;background:#dc3545;color:white;border:none;border-radius:4px;cursor:pointer;margin-left:5px">Delete</button>
              </td>
            </tr>
            `;
          }).join('')}
        </tbody>
      </table>
    </div>
    
    <div id="bulkPrice" class="tab-content">
      <div style="background:#f8f9fa;padding:20px;border-radius:8px;margin-bottom:20px">
        <h3>Bulk Price Update</h3>
        <p>Update prices for multiple customers at once</p>
        
        <div class="form-container">
          <div>
            <div class="form-group">
              <label>Select Item</label>
              <select id="bulkItem">
                ${appData.items.map(i => `<option value="${i.code}">${i.code} - ${i.name}</option>`).join('')}
              </select>
            </div>
            <div class="form-group">
              <label>Price Adjustment Type</label>
              <select id="adjustmentType">
                <option value="fixed">Fixed Amount</option>
                <option value="percentage">Percentage Increase</option>
                <option value="decrease">Percentage Decrease</option>
              </select>
            </div>
          </div>
          <div>
            <div class="form-group">
              <label>Adjustment Value</label>
              <input type="number" id="adjustmentValue" value="0">
            </div>
            <div class="form-group">
              <label>Effective Date</label>
              <input type="date" id="bulkEffectiveDate" value="${new Date().toISOString().split('T')[0]}">
            </div>
          </div>
        </div>
        
        <div style="margin-top:20px">
          <h4>Select Customers for Bulk Update</h4>
          <div style="max-height:200px;overflow-y:auto;border:1px solid #ddd;padding:10px;border-radius:6px">
            ${appData.customers.map(c => `
              <div>
                <input type="checkbox" id="cust_${c.id}" value="${c.id}" checked>
                <label for="cust_${c.id}">${c.name} (${c.category})</label>
              </div>
            `).join('')}
          </div>
        </div>
        
        <div style="margin-top:20px;text-align:center">
          <button class="action-btn action-btn-success" onclick="applyBulkUpdate()" style="padding:10px 30px">
            Apply Bulk Update
          </button>
        </div>
      </div>
      
      <div style="background:#e9f2ff;padding:15px;border-radius:8px">
        <h4>Bulk Update Preview</h4>
        <div id="bulkPreview" style="font-size:14px">
          <!-- Preview will be shown here -->
        </div>
      </div>
    </div>
  `;
}

// Helper functions for Price Master - FIXED: Added to global scope
function switchTab(tabGroup, tabName){
  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
  
  event.target.classList.add('active');
  document.getElementById(tabName + 'Price').classList.add('active');
}

function updateCustomerCategory(){
  const customerId = document.getElementById('priceCustomer').value;
  const customer = appData.customers.find(c => c.id === customerId);
  if(customer){
    document.getElementById('customerCategory').value = customer.category;
  } else {
    document.getElementById('customerCategory').value = '';
  }
}

function calculateFinalPrice(){
  const basePrice = parseFloat(document.getElementById('basePrice').value) || 0;
  const taxPercent = parseFloat(document.getElementById('taxPercent').value) || 0;
  const finalPrice = basePrice + (basePrice * taxPercent / 100);
  document.getElementById('finalPrice').value = finalPrice.toFixed(2);
}

function savePriceRecord(){
  const customerId = document.getElementById('priceCustomer').value;
  const itemCode = document.getElementById('priceItem').value;
  const basePrice = parseFloat(document.getElementById('basePrice').value);
  const taxPercent = parseFloat(document.getElementById('taxPercent').value);
  const effectiveDate = document.getElementById('effectiveDate').value;
  
  if(!customerId || !itemCode){
    alert('Please select customer and item');
    return;
  }
  
  // Generate new ID
  const newId = appData.priceMaster.length > 0 ? 
    Math.max(...appData.priceMaster.map(p => p.id)) + 1 : 1;
  
  // Add to data
  appData.priceMaster.push({
    id: newId,
    customerId: customerId,
    itemCode: itemCode,
    basePrice: basePrice,
    tax: taxPercent,
    effectiveDate: effectiveDate
  });
  
  alert('Price saved successfully for this customer!');
  // Switch to view tab
  switchTab('priceTab', 'view');
  // Refresh view
  loadModule('priceMaster');
}

function savePriceForAllCustomers(){
  const itemCode = document.getElementById('priceItem').value;
  const basePrice = parseFloat(document.getElementById('basePrice').value);
  const taxPercent = parseFloat(document.getElementById('taxPercent').value);
  const effectiveDate = document.getElementById('effectiveDate').value;
  
  if(!itemCode){
    alert('Please select an item first');
    return;
  }
  
  if(confirm('Apply this price to ALL customers?')){
    appData.customers.forEach(customer => {
      // Check if price already exists
      const existingIndex = appData.priceMaster.findIndex(
        p => p.customerId === customer.id && p.itemCode === itemCode
      );
      
      if(existingIndex >= 0){
        // Update existing
        appData.priceMaster[existingIndex].basePrice = basePrice;
        appData.priceMaster[existingIndex].tax = taxPercent;
        appData.priceMaster[existingIndex].effectiveDate = effectiveDate;
      } else {
        // Add new
        const newId = appData.priceMaster.length > 0 ? 
          Math.max(...appData.priceMaster.map(p => p.id)) + 1 : 1;
        
        appData.priceMaster.push({
          id: newId,
          customerId: customer.id,
          itemCode: itemCode,
          basePrice: basePrice,
          tax: taxPercent,
          effectiveDate: effectiveDate
        });
      }
    });
    
    alert('Price applied to all customers successfully!');
    loadModule('priceMaster');
  }
}

function filterPriceTable(){
  const search = document.getElementById('searchPrice').value.toLowerCase();
  const customerFilter = document.getElementById('filterCustomer').value;
  const itemFilter = document.getElementById('filterItem').value;
  
  // Filter table rows
  const rows = document.querySelectorAll('#priceTable tbody tr');
  rows.forEach(row => {
    const text = row.textContent.toLowerCase();
    const customerMatch = !customerFilter || row.cells[0].textContent.includes(customerFilter);
    const itemMatch = !itemFilter || row.cells[2].textContent.includes(itemFilter);
    const searchMatch = !search || text.includes(search);
    
    row.style.display = (customerMatch && itemMatch && searchMatch) ? '' : 'none';
  });
}

function editPrice(id){
  const price = appData.priceMaster.find(p => p.id === id);
  if(price){
    document.getElementById('priceCustomer').value = price.customerId;
    document.getElementById('priceItem').value = price.itemCode;
    document.getElementById('basePrice').value = price.basePrice;
    document.getElementById('taxPercent').value = price.tax;
    document.getElementById('effectiveDate').value = price.effectiveDate;
    calculateFinalPrice();
    
    switchTab('priceTab', 'setup');
    alert('Price loaded for editing. Update values and click Save.');
  }
}

function deletePrice(id){
  if(confirm('Are you sure you want to delete this price record?')){
    const index = appData.priceMaster.findIndex(p => p.id === id);
    if(index > -1){
      appData.priceMaster.splice(index, 1);
      loadModule('priceMaster');
    }
  }
}

function applyBulkUpdate(){
  alert('Bulk update feature would apply price changes to selected customers');
}

// ITEM MASTER
function generateItemMaster(){
  return `
    <div class="form-container">
      <div>
        <div class="form-group">
          <label>Item Code</label>
          <input type="text" id="itemCode" value="ITM-${String(appData.items.length + 1).padStart(3, '0')}">
        </div>
        <div class="form-group">
          <label>Item Name</label>
          <input type="text" id="itemName" placeholder="Enter item name">
        </div>
        <div class="form-group">
          <label>Category</label>
          <select id="itemCategory">
            <option value="Glass">Glass</option>
            <option value="Hardware">Hardware</option>
            <option value="Accessories">Accessories</option>
            <option value="Tools">Tools</option>
            <option value="Consumables">Consumables</option>
          </select>
        </div>
      </div>
      <div>
        <div class="form-group">
          <label>Unit</label>
          <select id="itemUnit">
            <option value="Sq. Ft">Square Feet</option>
            <option value="Sq. Mtr">Square Meter</option>
            <option value="Piece">Piece</option>
            <option value="Set">Set</option>
            <option value="Kg">Kilogram</option>
            <option value="Liter">Liter</option>
          </select>
        </div>
        <div class="form-group">
          <label>HSN Code</label>
          <input type="text" id="hsnCode" placeholder="Enter HSN code">
        </div>
        <div class="form-group">
          <label>Status</label>
          <select id="itemStatus">
            <option value="Active">Active</option>
            <option value="Inactive">Inactive</option>
          </select>
        </div>
      </div>
    </div>
    
    <div style="text-align:center;margin:20px 0">
      <button class="action-btn action-btn-success" onclick="addNewItem()" style="padding:10px 30px">Add New Item</button>
    </div>
    
    <h3>Item List</h3>
    <table class="data-table">
      <thead>
        <tr>
          <th>Item Code</th>
          <th>Item Name</th>
          <th>Category</th>
          <th>Unit</th>
          <th>HSN Code</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        ${appData.items.map(item => `
          <tr>
            <td>${item.code}</td>
            <td>${item.name}</td>
            <td>${item.category}</td>
            <td>${item.unit}</td>
            <td>${item.hsn || 'N/A'}</td>
            <td><span class="status-badge ${item.status === 'Active' ? 'status-active' : 'status-inactive'}">
              ${item.status || 'Active'}
            </span></td>
            <td>
              <button onclick="editItem('${item.code}')" style="padding:4px 8px;background:#ffc107;border:none;border-radius:4px;cursor:pointer">Edit</button>
            </td>
          </tr>
        `).join('')}
      </tbody>
    </table>
  `;
}

// Helper functions for Item Master
function addNewItem(){
  const code = document.getElementById('itemCode').value;
  const name = document.getElementById('itemName').value;
  const category = document.getElementById('itemCategory').value;
  const unit = document.getElementById('itemUnit').value;
  const hsn = document.getElementById('hsnCode').value;
  const status = document.getElementById('itemStatus').value;
  
  if(!name){
    alert('Please enter item name');
    return;
  }
  
  appData.items.push({
    code: code,
    name: name,
    category: category,
    unit: unit,
    hsn: hsn,
    status: status
  });
  
  alert('Item added successfully!');
  loadModule('itemMaster');
}

function editItem(code){
  const item = appData.items.find(i => i.code === code);
  if(item){
    document.getElementById('itemCode').value = item.code;
    document.getElementById('itemName').value = item.name;
    document.getElementById('itemCategory').value = item.category;
    document.getElementById('itemUnit').value = item.unit;
    document.getElementById('hsnCode').value = item.hsn || '';
    document.getElementById('itemStatus').value = item.status || 'Active';
    alert('Item loaded for editing. Update values and click Add New Item to save changes.');
  }
}

// CUSTOMER REGISTRATION
function generateCustomerRegistration(){
  return `
    <div class="form-container">
      <div>
        <div class="form-group">
          <label>Customer ID</label>
          <input type="text" id="custId" value="CUST-${String(appData.customers.length + 1).padStart(3, '0')}" readonly>
        </div>
        <div class="form-group">
          <label>Customer Name *</label>
          <input type="text" id="custName" placeholder="Enter customer name">
        </div>
        <div class="form-group">
          <label>Contact Person</label>
          <input type="text" id="contactPerson" placeholder="Enter contact person name">
        </div>
        <div class="form-group">
          <label>Mobile Number *</label>
          <input type="text" id="mobile" placeholder="Enter 10-digit mobile number">
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="email" placeholder="Enter email address">
        </div>
      </div>
      <div>
        <div class="form-group">
          <label>Customer Category</label>
          <select id="custCategory">
            <option value="Retail">Retail</option>
            <option value="Wholesale">Wholesale</option>
            <option value="Contractor">Contractor</option>
            <option value="Dealer">Dealer</option>
            <option value="Corporate">Corporate</option>
          </select>
        </div>
        <div class="form-group">
          <label>Address</label>
          <textarea id="address" rows="3" placeholder="Enter complete address"></textarea>
        </div>
        <div class="form-group">
          <label>City</label>
          <input type="text" id="city" placeholder="Enter city">
        </div>
        <div class="form-group">
          <label>State</label>
          <input type="text" id="state" placeholder="Enter state">
        </div>
        <div class="form-group">
          <label>GST Number</label>
          <input type="text" id="gst" placeholder="Enter GST number">
        </div>
      </div>
    </div>
    
    <div style="text-align:center;margin:30px 0">
      <button class="action-btn action-btn-success" onclick="registerCustomer()" style="padding:12px 40px;font-size:16px">
        Register Customer
      </button>
      <button class="action-btn" onclick="clearCustomerForm()" style="padding:12px 40px;font-size:16px;margin-left:10px">
        Clear Form
      </button>
    </div>
  `;
}

// Helper functions for Customer Registration
function registerCustomer(){
  const name = document.getElementById('custName').value;
  const mobile = document.getElementById('mobile').value;
  
  if(!name || !mobile){
    alert('Customer Name and Mobile Number are required');
    return;
  }
  
  if(mobile.length !== 10 || isNaN(mobile)){
    alert('Please enter a valid 10-digit mobile number');
    return;
  }
  
  const customer = {
    id: document.getElementById('custId').value,
    name: name,
    contactPerson: document.getElementById('contactPerson').value,
    mobile: mobile,
    email: document.getElementById('email').value,
    category: document.getElementById('custCategory').value,
    address: document.getElementById('address').value,
    city: document.getElementById('city').value,
    state: document.getElementById('state').value,
    gst: document.getElementById('gst').value,
    registrationDate: new Date().toISOString().split('T')[0]
  };
  
  appData.customers.push(customer);
  
  alert('Customer registered successfully! Customer ID: ' + customer.id);
  clearCustomerForm();
  // Generate new ID for next registration
  document.getElementById('custId').value = 'CUST-' + String(appData.customers.length + 1).padStart(3, '0');
}

function clearCustomerForm(){
  document.getElementById('custName').value = '';
  document.getElementById('contactPerson').value = '';
  document.getElementById('mobile').value = '';
  document.getElementById('email').value = '';
  document.getElementById('address').value = '';
  document.getElementById('city').value = '';
  document.getElementById('state').value = '';
  document.getElementById('gst').value = '';
}

// All other module generation functions remain exactly the same
// ... (keep all other generate functions as they are)

// Action functions
function saveModule(moduleName){
  alert(`Changes saved for ${moduleName} module`);
}

function printModule(moduleName){
  alert(`Printing ${moduleName} module`);
}

function exportModule(moduleName){
  alert(`Exporting ${moduleName} module data`);
}

// Auto-login for demo - FIXED: Added event listener for Enter key
window.onload = function() {
  // Auto-fill login for demo
  document.getElementById('u').value = 'admin';
  document.getElementById('p').value = 'admin123';
  
  // Add event listener for Enter key in both fields
  document.getElementById('u').addEventListener('keypress', function(e){
    if(e.key === 'Enter'){
      login();
    }
  });
  
  document.getElementById('p').addEventListener('keypress', function(e){
    if(e.key === 'Enter'){
      login();
    }
  });
};
</script>

</body>
</html>
