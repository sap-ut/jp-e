<!DOCTYPE html>
<html>
<head>
    <title>Glass ERP</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        function showSection(sectionId){
            document.querySelectorAll('.section').forEach(s=>s.style.display='none');
            document.getElementById(sectionId).style.display='block';
        }
        function exportPDF(){
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const table = document.getElementById("jobcardTable");
            doc.text("Glass ERP - Job Cards",10,10);
            let y = 20;
            for(let i=0;i<table.rows.length;i++){
                let row = [];
                for(let j=0;j<table.rows[i].cells.length;j++){
                    row.push(table.rows[i].cells[j].innerText);
                }
                doc.text(row.join(" | "),10,y);
                y+=10;
            }
            doc.save("JobCards.pdf");
        }
    </script>
</head>
<body>
    <!-- Menu -->
    <div class="menu-bar">
        <button onclick="showSection('dashboard')">Dashboard</button>
        <button onclick="showSection('parties')">Parties</button>
        <button onclick="showSection('items')">Items</button>
        <button onclick="showSection('jobcards')">Job Cards</button>
        <a href="{{ url_for('logout') }}"><button>Logout</button></a>
    </div>

    <!-- Sections -->
    <div id="dashboard" class="section">
        <h2>Welcome to Glass ERP Dashboard</h2>
        <p>Select any menu to manage data.</p>
    </div>

    <div id="parties" class="section" style="display:none;">
        <h2>Parties</h2>
        <form method="POST" action="{{ url_for('parties') }}">
            <input type="text" name="name" placeholder="Party Name" required>
            <input type="text" name="contact" placeholder="Contact">
            <button type="submit">Add Party</button>
        </form>
        <table>
            <tr><th>ID</th><th>Name</th><th>Contact</th></tr>
            {% for p in parties %}
            <tr><td>{{ p.id }}</td><td>{{ p.name }}</td><td>{{ p.contact }}</td></tr>
            {% endfor %}
        </table>
    </div>

    <div id="items" class="section" style="display:none;">
        <h2>Items</h2>
        <form method="POST" action="{{ url_for('items') }}">
            <input type="text" name="name" placeholder="Item Name" required>
            <input type="number" step="0.01" name="rate" placeholder="Rate per sq.mt" required>
            <button type="submit">Add Item</button>
        </form>
        <table>
            <tr><th>ID</th><th>Name</th><th>Rate per sq.mt</th></tr>
            {% for i in items %}
            <tr><td>{{ i.id }}</td><td>{{ i.name }}</td><td>{{ i.rate_per_sqmt }}</td></tr>
            {% endfor %}
        </table>
    </div>

    <div id="jobcards" class="section" style="display:none;">
        <h2>Job Cards</h2>
        <form method="POST" action="{{ url_for('jobcards') }}">
            <select name="party" required>
                <option value="">Select Party</option>
                {% for p in parties %}<option value="{{ p.id }}">{{ p.name }}</option>{% endfor %}
            </select>
            <select name="item" required>
                <option value="">Select Item</option>
                {% for i in items %}<option value="{{ i.id }}">{{ i.name }}</option>{% endfor %}
            </select>
            <input type="number" step="0.01" name="length" placeholder="Length (m)" required>
            <input type="number" step="0.01" name="width" placeholder="Width (m)" required>
            <input type="number" name="holes" placeholder="Small Holes">
            <input type="number" name="big_holes" placeholder="Big Holes">
            <input type="number" step="0.01" name="add_charges" placeholder="Additional Charges">
            <button type="submit">Create Job Card</button>
        </form>
        <button onclick="exportPDF()">Export PDF</button>
        <table id="jobcardTable">
            <tr>
                <th>ID</th><th>Party</th><th>Item</th><th>Length</th><th>Width</th>
                <th>Holes</th><th>Big Holes</th><th>Add Charges</th><th>Total Amount</th><th>Date</th>
            </tr>
            {% for jc in jobcards %}
            <tr>
                <td>{{ jc.id }}</td>
                <td>{{ jc.party.name }}</td>
                <td>{{ jc.item.name }}</td>
                <td>{{ jc.length }}</td>
                <td>{{ jc.width }}</td>
                <td>{{ jc.holes }}</td>
                <td>{{ jc.big_holes }}</td>
                <td>{{ jc.add_charges }}</td>
                <td>{{ jc.total_amount }}</td>
                <td>{{ jc.date_created.strftime('%d-%m-%Y') }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
</body>
</html>
